turbine_layout = [[10307250.0, 6522144.313559998], [10307250.0, 6522174.31356], [10307250.0, 6522204.313559993], [10307250.0, 6522234.31358715], [10307321.235693488, 6522212.936121039], [10307342.454229452, 6522144.313561116], [10307366.391476486, 6522257.783458199], [10307426.253616257, 6522317.900894074], [10307377.503086334, 6522144.313559985], [10307636.433601659, 6522323.172472882], [10307410.049156466, 6522144.313559987], [10307594.815576816, 6522254.261651804], [10307641.251312714, 6522570.540218691], [10307825.06319188, 6522183.91675118], [10307353.793632098, 6522725.597180408], [10307279.999999978, 6522144.31356], [10307310.000061773, 6522144.313559994], [10307440.346518558, 6522144.313559992], [10307537.415883183, 6522144.313559988], [10307577.433699599, 6522144.3135599885], [10307472.584377185, 6522144.313559989], [10307617.750881081, 6522144.313559992], [10307505.025135037, 6522144.313559992], [10307735.278121114, 6522144.313560476], [10307804.864338266, 6522144.313559993], [10307970.32678137, 6522266.671542195], [10307884.757714564, 6522189.374983662], [10307545.366028717, 6522206.7079427], [10307631.329068664, 6522810.651309452], [10308193.835554648, 6522824.31356], [10307667.36963195, 6522144.31356], [10307704.668152492, 6522144.313559994], [10307767.712910892, 6522144.313559993], [10307847.566988308, 6522144.313560067], [10307952.587303516, 6522144.313559992], [10307889.729196467, 6522144.313559996], [10308002.627035761, 6522144.31450619], [10308047.666136118, 6522144.313559994], [10307944.883386014, 6522232.066743701], [10307910.3684692, 6522209.660328246], [10308002.530367402, 6522299.409285081], [10308182.532641586, 6522351.742833877], [10308079.80035885, 6522404.459986318], [10308329.999998145, 6522769.26465248], [10308312.392985957, 6522649.125900334], [10308097.56653616, 6522144.31356], [10308155.08563204, 6522144.313559997], [10308237.370114248, 6522144.313559994], [10308235.005360069, 6522231.761641844], [10308157.431597484, 6522307.05175286], [10308037.589148736, 6522346.559731017], [10308329.998229671, 6522211.864703582], [10308170.536434166, 6522488.905640339], [10308202.523052163, 6522381.929498263], [10308285.501173448, 6522629.34172304], [10308237.3283789, 6522546.809974034], [10308262.650307374, 6522594.3583348375], [10308315.46586495, 6522709.658877475], [10308261.551863223, 6522824.313560006], [10308300.00000002, 6522824.31356], [10308122.686676957, 6522264.408850515], [10308085.197760254, 6522229.090781315], [10308322.457578769, 6522144.3135607755], [10308302.618439196, 6522364.254165165], [10308329.999884699, 6522406.842906496], [10308327.386925258, 6522284.429316255], [10308224.91257554, 6522416.775674021], [10308250.2201755, 6522451.935759752], [10308279.843822138, 6522484.193777877], [10308299.945268901, 6522511.728258518], [10308329.99997641, 6522579.372476745], [10308315.202662917, 6522541.851577372], [10308305.189724227, 6522681.462736624], [10308329.560624292, 6522736.613211282], [10308330.0, 6522824.313560001]]

import opentidalfarm as otf
from dolfin import *

domain = otf.FileDomain('mesh/earth_orkney_converted_coarse.xml')
V, H = otf.finite_elements.p2p1(domain.mesh)
func_space = dolfin.FunctionSpace(domain.mesh, "CG", 1)
friction_fld = dolfin.Function(func_space, 'Friction_fld.xml')
friction_ebb = dolfin.Function(func_space, 'Friction_ebb.xml')

import pylab as plt
import scipy.interpolate
import numpy

friction_ebb_np = friction_ebb.vector().array()
friction_fld_np = friction_fld.vector().array()

print 'fld', max(friction_fld_np), min(friction_fld_np)
print 'ebb', max(friction_ebb_np), max(friction_ebb_np)

friction_combined =  (friction_ebb_np + friction_fld_np) / 2

# extract the mesh coordinates and set up interpolation points
mesh = domain.mesh
coords = mesh.coordinates()
x = coords[:,0]
y = coords[:,1]

xi, yi = numpy.linspace(x.min(), x.max(), 3000), numpy.linspace(y.min(), y.max(), 3000)
xi, yi = numpy.meshgrid(xi, yi)

zi = scipy.interpolate.griddata((x, y), friction_combined, (xi, yi), method='linear')
plt.imshow(zi, vmin=min(friction_combined), vmax=max(friction_combined), origin='lower', extent=[x.min(), x.max(), y.min(), y.max()])

plt.colorbar()

turb_coordinates = numpy.array(turbine_layout)

plt.plot(turb_coordinates[:,0], turb_coordinates[:,1], '.', color='black')

plt.xlim(x.min(), x.max())
plt.ylim(y.min(), y.max())
plt.gca().set_aspect('equal', adjustable='box')
fig = plt.gcf()

fig.set_size_inches(15, 15)
fig.savefig('test_01.png')
fig.clf()
